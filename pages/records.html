<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª ÙˆØ§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</title>
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https://www.google.com; connect-src 'self' https://raw.githubusercontent.com https://api.telegram.org;">
    <link rel="stylesheet" href="../css/style.css">
</head>

<body>

    <h2>ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª ÙˆØ§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h2>


    <table id="recordsTable" border="1">
        <thead>
            <tr>
                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                <th>Ø§Ù„Ù†ÙˆØ¹</th>
                <th>Ø§Ù„Ø§Ø³Ù…</th>
                <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                <th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                <th>Ø§Ù„ØªØ­ÙƒÙ…</th>
            </tr>

        </thead>
        <tbody>
            <!-- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‡ØªØªØ­Ø· Ù‡Ù†Ø§ -->
        </tbody>
    </table>

    <div id="summarySection"
        style="margin: 20px 0; padding: 15px; background: #e8f4fd; border-radius: 8px; border: 1px solid #3498db; text-align: center;">
        <h3 id="dailyTotalDisplay" style="margin: 0; color: #2c3e50;">ğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙŠÙˆÙ…: 0 Ø¬.Ù…</h3>
    </div>

    <button id="1128758021" class="saveBtn">ğŸ’¾ Ø­ÙØ¸ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…</button>
    <p id="message"></p>



    <div class="back-btn">
        <a href="index.html" class="btn">ğŸ  Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø°ÙŠ ÙŠØ¸Ù‡Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø© -->
    <div id="passwordModal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); justify-content: center; align-items: center;">
        <div style="background: white; padding: 20px; border-radius: 8px; text-align: center;">
            <h2>Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h2>
            <input type="password" id="password" placeholder="Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
                style="padding: 10px; margin: 10px 0; border-radius: 6px; border: 1px solid #ccc;">
            <button id="submitPassword"
                style="padding: 10px 20px; background-color: #3498db; color: white; border-radius: 6px;">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>

    </div>

    <script>
        const BOT_TOKEN = "8499366707:AAFgYQf25seW_zXu-B7gOe1IBk8DdTugb_U";
        const OLD_CHAT_ID = "1724117996";
        const NEW_CHAT_ID = "";

        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯
        function showNotification(message, type = 'success') {
            const container = document.getElementById('notificationContainer') || createNotificationContainer();
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `<span>${message}</span>`;
            container.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.5s forwards';
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }

        function createNotificationContainer() {
            const container = document.createElement('div');
            container.id = 'notificationContainer';
            container.className = 'notification-container';
            document.body.appendChild(container);
            return container;
        }

        const tableBody = document.querySelector("#recordsTable tbody");
        const message = document.getElementById("message");

        let records = JSON.parse(localStorage.getItem("records")) || [];

        function renderTable() {
            tableBody.innerHTML = "";
            let dailyTotal = 0;
            const today = new Date().toLocaleDateString();

            if (records.length === 0) {
                const row = document.createElement("tr");
                row.innerHTML = `<td colspan="6" style="text-align:center;">âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯</td>`;
                tableBody.appendChild(row);
                document.getElementById("dailyTotalDisplay").textContent = `ğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙŠÙˆÙ…: 0 Ø¬.Ù…`;
                return;
            }

            records.forEach((r, index) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${r.date}</td>
                    <td>${r.type}</td>
                    <td>${r.customer}</td>
                    <td>${r.phone || "â€”"}</td>
                    <td>${r.problem || r.device || "â€”"}</td>
                    <td>${r.status || "â€”"}</td>
                    <td>${r.price} Ø¬.Ù…</td>
                    <td><button class="deleteBtn" data-index="${index}">ğŸ—‘ï¸ Ù…Ø³Ø­</button></td>
                `;
                tableBody.appendChild(row);

                // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙŠÙˆÙ… ÙÙ‚Ø· Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
                if (r.date === today) {
                    if (r.type === "Ø¨ÙŠØ¹" || (r.type === "ØµÙŠØ§Ù†Ø©" && r.status === "ØªÙ…")) {
                        dailyTotal += Number(r.price) || 0;
                    }
                }
            });

            document.getElementById("dailyTotalDisplay").textContent = `ğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙŠÙˆÙ… (${today}): ${dailyTotal} Ø¬.Ù…`;
        }

        renderTable();

        // Ø­Ø¯Ø« Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„ Ù…Ø¹ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯
        tableBody.addEventListener("click", async (event) => {
            if (!(event.target && event.target.classList.contains("deleteBtn"))) return;

            const index = Number(event.target.getAttribute("data-index"));
            if (isNaN(index) || !records[index]) return;

            const deletedRecord = records[index];

            // Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯
            document.getElementById('passwordModal').style.display = 'flex';
            document.getElementById('password').value = '';

            // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ù…Ø³ØªÙ…Ø¹ Ø³Ø§Ø¨Ù‚ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø±
            const submitBtn = document.getElementById('submitPassword');
            const newSubmitBtn = submitBtn.cloneNode(true);
            submitBtn.parentNode.replaceChild(newSubmitBtn, submitBtn);

            newSubmitBtn.addEventListener('click', async function () {
                const enteredPassword = document.getElementById('password').value;

                if (enteredPassword === '11225588') {
                    let text = "<b>ğŸš¨ ØªÙ… Ù…Ø³Ø­ Ø³Ø¬Ù„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª ÙˆØ§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</b>\n\n";
                    text += `ğŸ•“ <b>Ø§Ù„ØªØ§Ø±ÙŠØ®:</b> ${deletedRecord.date}\n`;
                    text += `ğŸ“¦ <b>Ø§Ù„Ù†ÙˆØ¹:</b> ${deletedRecord.type}\n`;
                    text += `ğŸ‘¤ <b>Ø§Ù„Ø§Ø³Ù…:</b> ${deletedRecord.customer}\n`;
                    text += `ğŸ§¾ <b>ØªÙØ§ØµÙŠÙ„:</b> ${deletedRecord.problem || deletedRecord.device || "â€”"}\n`;
                    text += `ğŸ’° <b>Ø§Ù„Ù…Ø¨Ù„Øº:</b> ${deletedRecord.price}\n`;
                    text += "----------------------\n";

                    try {
                        const promises = [];
                        if (OLD_CHAT_ID) {
                            promises.push(fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                                method: "POST",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify({ chat_id: OLD_CHAT_ID, text, parse_mode: "HTML" })
                            }));
                        }
                        if (NEW_CHAT_ID) {
                            promises.push(fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                                method: "POST",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify({ chat_id: NEW_CHAT_ID, text, parse_mode: "HTML" })
                            }));
                        }

                        if (promises.length > 0) {
                            await Promise.all(promises);
                        }

                        records.splice(index, 1);
                        localStorage.setItem("records", JSON.stringify(records));
                        renderTable();
                        showNotification("ğŸ—‘ï¸ ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­");
                    } catch (err) {
                        console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„:", err);
                        showNotification("âš ï¸ ØªÙ… Ø§Ù„Ø­Ø°Ù Ù…Ø­Ù„ÙŠØ§Ù‹ ÙˆÙ„ÙƒÙ† ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±", "warning");
                        records.splice(index, 1);
                        localStorage.setItem("records", JSON.stringify(records));
                        renderTable();
                    }
                    document.getElementById('passwordModal').style.display = 'none';
                } else {
                    showNotification("âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©", "error");
                }
            });
        });

        // Ø²Ø± Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø¹Ø§Ù…
        document.querySelectorAll(".saveBtn").forEach(saveBtn => {
            saveBtn.addEventListener("click", async () => {
                const message = document.getElementById("message");
                if (records.length === 0) {
                    message.textContent = "âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§.";
                    message.style.color = "orange";
                    return;
                }

                let text = "<b>ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª ÙˆØ§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</b>\n\n";
                let dailyTotal = 0;
                const today = new Date().toLocaleDateString();

                records.forEach(r => {
                    text += `ğŸ•“ <b>Ø§Ù„ØªØ§Ø±ÙŠØ®:</b> ${r.date}\n`;
                    text += `ğŸ“¦ <b>Ø§Ù„Ù†ÙˆØ¹:</b> ${r.type}\n`;
                    text += `ğŸ‘¤ <b>Ø§Ù„Ø§Ø³Ù…:</b> ${r.customer}\n`;
                    text += `ğŸ“ <b>Ø§Ù„Ù‡Ø§ØªÙ:</b> ${r.phone || "â€”"}\n`;
                    text += `ğŸ§¾ <b>ØªÙØ§ØµÙŠÙ„:</b> ${r.problem || r.device || "â€”"}\n`;
                    text += `ğŸš¥ <b>Ø§Ù„Ø­Ø§Ù„Ø©:</b> ${r.status || "â€”"}\n`;
                    text += `ğŸ’° <b>Ø§Ù„Ù…Ø¨Ù„Øº:</b> ${r.price}\n`;
                    text += "----------------------\n";

                    if (r.date === today) {
                        if (r.type === "Ø¨ÙŠØ¹" || (r.type === "ØµÙŠØ§Ù†Ø©" && r.status === "ØªÙ…")) {
                            dailyTotal += Number(r.price) || 0;
                        }
                    }
                });

                text += `\nğŸ’° <b>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙŠÙˆÙ… (${today}):</b> ${dailyTotal} Ø¬.Ù…`;

                try {
                    const promises = [];
                    if (OLD_CHAT_ID) {
                        promises.push(fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ chat_id: OLD_CHAT_ID, text, parse_mode: "HTML" })
                        }));
                    }
                    if (NEW_CHAT_ID) {
                        promises.push(fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ chat_id: NEW_CHAT_ID, text, parse_mode: "HTML" })
                        }));
                    }

                    if (promises.length === 0) {
                        message.textContent = "âš ï¸ Ù„Ù… ÙŠØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø¹Ø±ÙØ§Øª ØªÙ„ÙŠØ¬Ø±Ø§Ù….";
                        message.style.color = "orange";
                        return;
                    }

                    const responses = await Promise.all(promises);
                    const allOk = responses.every(r => r.ok);

                    if (allOk) {
                        message.textContent = "âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ ØªÙ„ÙŠØ¬Ø±Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­!";
                        message.style.color = "green";
                    } else {
                        message.textContent = "âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø¹Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ ØªÙ„ÙŠØ¬Ø±Ø§Ù…!";
                        message.style.color = "red";
                    }
                } catch (err) {
                    console.error("Ø®Ø·Ø£:", err);
                    message.textContent = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„!";
                    message.style.color = "red";
                }
            });
        });
        /* ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„Ø§Ø²Ù… ØªØºÙŠØ±Ù‡Ø§ ÙÙ‚Ø· ===== */
        const clientID = "2"; // Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¹Ù†Ø¯Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¯Ù‡
        const STATUS_URL = "https://raw.githubusercontent.com/Mahmuod556/status/refs/heads/main/status.json"; // Ø¶Ø¹ Ù‡Ù†Ø§ Ø±Ø§Ø¨Ø· RAW Ø§Ù„Ù„ÙŠ Ù†Ø³Ø®ØªÙ‡
        /* =================================== */

        let isOffline = false;
        let isBlockedShown = false;
        let originalBodyContent = ""; // Ù‡Ù†Ø­ÙØ¸ ÙÙŠÙ‡Ø§ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£ØµÙ„ÙŠ

        function saveOriginalContent() {
            if (!originalBodyContent) {
                originalBodyContent = document.body.innerHTML;
            }
        }

        function showOfflineScreen() {
            if (!isOffline) {
                isOffline = true;
                saveOriginalContent();
                showNotification("âš ï¸ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ù…Ù‚Ø·ÙˆØ¹", "error");
                document.body.innerHTML = `
            <h2 style="text-align:center; margin-top:50px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª</h2>
        `;
            }
        }

        function showBlockedScreen() {
            if (!isBlockedShown) {
                isBlockedShown = true;
                saveOriginalContent();
                showNotification("ğŸš« ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù„Ø¹Ø¯Ù… Ø§Ù„ØªÙØ¹ÙŠÙ„", "error");
                document.body.innerHTML = `
            <h2 style="text-align:center; margin-top:50px;">
                ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ â€” Ø¨Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.
            </h2>
        `;
            }
        }

        function restoreOriginalContent() {
            if (originalBodyContent) {
                document.body.innerHTML = originalBodyContent;
                originalBodyContent = ""; // Ù†Ù…Ø³Ø­Ù‡Ø§ Ø¨Ø¹Ø¯ Ù…Ø§ Ù†Ø±Ø¬Ø¹Ù‡Ø§
            }
        }

        async function checkStatusOnline() {
            if (!navigator.onLine) return;
            try {
                const res = await fetch(STATUS_URL + "?nocache=" + Math.random(), { cache: "no-store" });
                if (!res.ok) throw new Error("status fetch failed");
                const data = await res.json();
                if (data[clientID] === "blocked") {
                    showBlockedScreen();
                } else if (isBlockedShown) {
                    location.reload();
                }
            } catch (e) {
                console.warn("Silent check failed:", e);
            }
        }

        function checkInternetFast() {
            if (!navigator.onLine) {
                if (!isOffline) {
                    isOffline = true;
                    showNotification("âš ï¸ Ø§Ù†Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª (ØµØ§Ù…Øª)", "warning");
                }
                return;
            }
            let img = new Image();
            img.src = "https://www.google.com/favicon.ico?" + Math.random();
            img.onload = function () {
                if (isOffline) {
                    isOffline = false;
                    showNotification("âœ… Ø¹Ø§Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª", "success");
                    checkStatusOnline();
                }
            };
            img.onerror = function () { console.warn("Check failed"); };
        }

        setInterval(checkInternetFast, 10000);
        setInterval(checkStatusOnline, 30000);

        // ÙØ­Øµ Ø£ÙˆÙ„ Ù…Ø±Ø© Ù„Ù…Ø§ Ø§Ù„ØµÙØ­Ø© ØªÙØªØ­
        checkInternetFast();
        checkStatusOnline();


    </script>

</body>

</html>